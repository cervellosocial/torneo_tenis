<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Subir fotos - Torneo de tenis</title>
  <meta name="description" content="P√°gina simple para subir y organizar fotos de un torneo de tenis (multiselecci√≥n, previsualizaci√≥n, eliminar, descargar ZIP)">
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#1e90ff;--muted:#9aa9bf;--glass:rgba(255,255,255,0.03)}
    html,body{height:100%;margin:0;font-family:Inter,Segoe UI,Roboto,system-ui,-apple-system,Arial}
    body{background:linear-gradient(180deg,#071125 0%, #071b2b 100%);color:#e6eef8;display:flex;align-items:center;justify-content:center;padding:32px}
    .container{width:100%;max-width:1100px}
    .card{background:var(--card);padding:20px;border-radius:14px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}

    header{display:flex;align-items:center;justify-content:space-between;gap:16px}
    header h1{margin:0;font-size:20px}
    p.lead{margin:6px 0 0;color:var(--muted);font-size:13px}

    .dropzone{margin-top:16px;border:2px dashed rgba(255,255,255,0.06);border-radius:10px;padding:18px;display:flex;gap:12px;align-items:center;cursor:pointer;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}
    .dropzone.drag{border-color:var(--accent);box-shadow:0 6px 30px rgba(30,144,255,0.06)}
    .dropzone .instructions{flex:1}
    .dropzone button{background:var(--accent);border:none;color:#05263a;padding:8px 12px;border-radius:8px;font-weight:600;cursor:pointer}

    .controls{display:flex;gap:12px;margin-top:14px;align-items:center}
    .controls button{padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
    .btn-secondary{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.03)}

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:12px;margin-top:16px}
    .thumb{background:var(--glass);padding:8px;border-radius:10px;display:flex;flex-direction:column;gap:8px;overflow:hidden}
    .thumb img{width:100%;height:110px;object-fit:cover;border-radius:8px}
    .thumb .meta{display:flex;gap:8px;align-items:center}
    .thumb input[type=text]{flex:1;padding:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .thumb .actions{display:flex;gap:6px}
    .small{font-size:12px;color:var(--muted)}

    footer{display:flex;justify-content:space-between;align-items:center;margin-top:16px}
    .note{font-size:13px;color:var(--muted)}

    @media (max-width:600px){.thumb img{height:90px}}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <header>
        <div>
          <h1>Subir fotos ‚Äî Torneo de tenis üéæ</h1>
          <p class="lead">Selecciona varias fotos, arr√°stralas, a√±ade leyendas y desc√°rgalas como ZIP. Perfecto para publicar en un repo o compartir con el equipo.</p>
        </div>
        <div class="small">Repositorio: <strong>GitHub Pages compatible</strong></div>
      </header>

      <label id="dropzone" class="dropzone" tabindex="0">
        <div class="instructions">
          <strong>Arrastra las fotos aqu√≠</strong> o haz clic en "Seleccionar" (se permiten varios archivos).
          <div class="small">Acepta im√°genes (jpg, png, webp). Tama√±o pr√°ctico: hasta 20 MB por archivo.</div>
        </div>
        <div>
          <input id="fileInput" type="file" accept="image/*" multiple style="display:none">
          <button id="selectBtn" type="button">Seleccionar</button>
        </div>
      </label>

      <div class="controls">
        <div>
          <button id="downloadZip" class="" title="Descargar todas las fotos como ZIP">üì¶ Descargar ZIP</button>
          <button id="clearAll" class="btn-secondary">üóëÔ∏è Limpiar todo</button>
        </div>
        <div style="margin-left:auto" class="small">Previsualizaci√≥n en el navegador ‚Äî los archivos no se suben a ning√∫n servidor.</div>
      </div>

      <div id="grid" class="grid" aria-live="polite"></div>

      <footer>
        <div class="note">Consejo: para subir a un servidor/endpoint POST, puedes usar la funci√≥n `uploadToServer()` incluida en este archivo y adaptarla a tu backend.</div>
        <div class="small">Creado para GitHub Pages ¬∑ 1 archivo</div>
      </footer>
    </div>
  </div>

  <!-- Dependencias para crear ZIPs y descargar: JSZip + FileSaver (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@4.1.0/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

  <script>
    // Estado en memoria
    const state = {items: []}; // {id, file, url, caption}

    const fileInput = document.getElementById('fileInput');
    const selectBtn = document.getElementById('selectBtn');
    const dropzone = document.getElementById('dropzone');
    const grid = document.getElementById('grid');
    const downloadZip = document.getElementById('downloadZip');
    const clearAll = document.getElementById('clearAll');

    // Helpers
    const uid = ()=>Math.random().toString(36).slice(2,9);

    function render() {
      grid.innerHTML = '';
      if(state.items.length === 0){
        grid.innerHTML = '<div class="small">No hay fotos a√∫n ‚Äî a√±ade algunas usando el bot√≥n o arrastrando archivos.</div>';
        return;
      }

      state.items.forEach(item=>{
        const el = document.createElement('div'); el.className='thumb';
        el.innerHTML = `
          <img alt="Foto torneo" src="${item.url}">
          <div class="meta">
            <input type="text" placeholder="A√±adir leyenda (opcional)" value="${escapeHtml(item.caption || '')}" data-id="${item.id}">
            <div class="actions">
              <button data-action="remove" data-id="${item.id}" title="Eliminar">‚úñ</button>
            </div>
          </div>
          <div class="small">${formatBytes(item.file.size)} ¬∑ ${item.file.type || 'image'}</div>
        `;
        grid.appendChild(el);
      });

      // bind events for caption inputs and remove buttons
      grid.querySelectorAll('input[type=text]').forEach(input=>{
        input.addEventListener('input', e=>{
          const id = e.target.dataset.id; const it = state.items.find(x=>x.id===id);
          if(it) it.caption = e.target.value;
        });
      });
      grid.querySelectorAll('button[data-action="remove"]').forEach(btn=>{
        btn.addEventListener('click', e=>{
          const id = e.target.dataset.id; removeById(id);
        });
      });
    }

    function escapeHtml(s){ return s.replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[c]); }
    function formatBytes(bytes){ if(bytes<1024) return bytes+' B'; if(bytes<1024*1024) return (bytes/1024).toFixed(1)+' KB'; return (bytes/(1024*1024)).toFixed(2)+' MB'; }

    function addFiles(files){
      const list = Array.from(files).filter(f=>f.type.startsWith('image/'));
      list.forEach(file=>{
        const id = uid();
        const url = URL.createObjectURL(file);
        state.items.push({id, file, url, caption: ''});
      });
      render();
    }

    function removeById(id){
      const idx = state.items.findIndex(x=>x.id===id);
      if(idx!==-1){ URL.revokeObjectURL(state.items[idx].url); state.items.splice(idx,1); render(); }
    }

    // Drag & drop
    ['dragenter','dragover'].forEach(ev=>{
      dropzone.addEventListener(ev, e=>{ e.preventDefault(); e.stopPropagation(); dropzone.classList.add('drag'); });
    });
    ['dragleave','drop'].forEach(ev=>{
      dropzone.addEventListener(ev, e=>{ e.preventDefault(); e.stopPropagation(); dropzone.classList.remove('drag'); });
    });
    dropzone.addEventListener('drop', e=>{ const dt = e.dataTransfer; if(dt && dt.files) addFiles(dt.files); });

    // File input
    selectBtn.addEventListener('click', ()=>fileInput.click());
    fileInput.addEventListener('change', ()=>{ if(fileInput.files.length) addFiles(fileInput.files); fileInput.value='';});

    // Keyboard accessibility: open file dialog on Enter/Space
    dropzone.addEventListener('keydown', e=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); fileInput.click(); } });

    // Clear all
    clearAll.addEventListener('click', ()=>{
      if(!confirm('¬øEliminar todas las fotos de la sesi√≥n actual?')) return;
      state.items.forEach(i=>URL.revokeObjectURL(i.url)); state.items=[]; render();
    });

    // ZIP creation and download
    downloadZip.addEventListener('click', async ()=>{
      if(state.items.length===0){ alert('No hay fotos para descargar.'); return; }
      downloadZip.disabled=true; downloadZip.textContent='Preparando ZIP...';
      try{
        const zip = new JSZip();
        const captions = [];
        for(const it of state.items){
          const arrayBuffer = await it.file.arrayBuffer();
          // Guardar con nombre legible: <timestamp>_<originalname>
          const safeName = sanitizeFilename(it.file.name) || (it.id + '.jpg');
          zip.file(safeName, arrayBuffer);
          captions.push({file: safeName, caption: it.caption || ''});
        }
        zip.file('captions.json', JSON.stringify(captions, null, 2));
        const blob = await zip.generateAsync({type:'blob'});
        saveAs(blob, 'fotos-torneo.zip');
      }catch(err){ console.error(err); alert('Error preparando el ZIP. Revisa la consola.'); }
      downloadZip.disabled=false; downloadZip.textContent='üì¶ Descargar ZIP';
    });

    function sanitizeFilename(name){ return name.replace(/[^a-z0-9_.-]/gi,'_'); }

    // Example placeholder to upload to server. Not active by default.
    async function uploadToServer(endpointUrl){
      // Endpoint should accept multipart/form-data
      const form = new FormData();
      state.items.forEach((it,idx)=>{ form.append('photos[]', it.file, it.file.name); form.append('captions[]', it.caption || ''); });
      const resp = await fetch(endpointUrl,{method:'POST',body:form});
      return resp;
    }

    // Init
    render();
  </script>
</body>
</html>
